change ssh port script · GitHub
Skip to content
Search Gists
Search Gists
All gists
Back to GitHub
Sign in
Sign up
Sign in
Sign up
You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.
Dismiss alert
Instantly share code, notes, and snippets.
iraj-zahedi/gist:d13f298071df8bcd2586f8482f132f16
Created
September 17, 2025 08:04
Show Gist options
Download ZIP
Star
1
(1)
You must be signed in to star a gist
Fork
0
(0)
You must be signed in to fork a gist
Embed
Embed
Embed this gist in your website.
Share
Copy sharable link for this gist.
Clone via HTTPS
Clone using the web URL.
Learn more about clone URLs
Clone this repository at &lt;script src=&quot;https://gist.github.com/iraj-zahedi/d13f298071df8bcd2586f8482f132f16.js&quot;&gt;&lt;/script&gt;
Save iraj-zahedi/d13f298071df8bcd2586f8482f132f16 to your computer and use it in GitHub Desktop.
Code
Revisions
1
Stars
1
Embed
Embed
Embed this gist in your website.
Share
Copy sharable link for this gist.
Clone via HTTPS
Clone using the web URL.
Learn more about clone URLs
Clone this repository at &lt;script src=&quot;https://gist.github.com/iraj-zahedi/d13f298071df8bcd2586f8482f132f16.js&quot;&gt;&lt;/script&gt;
Save iraj-zahedi/d13f298071df8bcd2586f8482f132f16 to your computer and use it in GitHub Desktop.
Download ZIP
change ssh port script
Raw
gistfile1.txt
#!/bin/bash
# A robust script to change the SSH port on various systemd-based Linux distributions
# including Ubuntu (20.04+), Debian, AlmaLinux (8, 9, 10), and others.
# --- Ensure the script is run as root ---
if [ "$EUID" -ne 0 ]; then
echo "Please run this script as root."
exit 1
fi
# --- Prompt user for the new port ---
echo ""
echo -n "Please enter the new SSH port: "
while read SSHPORT; do
# Check if input is a valid number between 1024-65535
if [[ "$SSHPORT" =~ ^[0-9]+$ && "$SSHPORT" -ge 1024 && "$SSHPORT" -le 65535 ]]; then
break
else
echo -e "Invalid port: must be a number between 1024 and 65535."
echo -n "Please enter the new SSH port: "
fi
done
# --- Backup and Modify SSH Configuration ---
echo "Backing up /etc/ssh/sshd_config..."
NOW=$(date +"%Y-%m-%d_%H-%M-%S")
cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup.$NOW
echo "Changing port to $SSHPORT in /etc/ssh/sshd_config..."
# Remove any existing Port or #Port lines to avoid duplicates
sed -i '/^#\?Port/d' /etc/ssh/sshd_config
# Add the new Port configuration
echo "Port $SSHPORT" >> /etc/ssh/sshd_config
sleep 1
# --- Firewall and SELinux Management ---
# Check for firewalld (common on AlmaLinux/RHEL/CentOS)
if command -v firewall-cmd &> /dev/null; then
echo "Firewalld detected. Adding port $SSHPORT..."
firewall-cmd --permanent --add-port=${SSHPORT}/tcp
firewall-cmd --reload
echo "Firewalld rule updated."
# Handle SELinux (crucial for RHEL-based distros)
if command -v semanage &> /dev/null; then
echo "SELinux detected. Applying port context..."
semanage port -a -t sshd_port_t -p tcp $SSHPORT
echo "SELinux policy updated for port $SSHPORT."
else
echo "Warning: 'semanage' command not found. If SELinux is enforced, you may need to install 'policycoreutils-python-utils' and run the semanage command manually."
fi
# Check for ufw (common on Ubuntu/Debian)
elif command -v ufw &> /dev/null; then
echo "UFW detected. Adding rule for port $SSHPORT..."
ufw allow $SSHPORT/tcp
echo "UFW rule updated."
else
echo "Warning: No known firewall (firewalld, ufw) was detected. Please configure your firewall manually to allow port $SSHPORT."
fi
# --- Restart SSH Service (The Smart Way) ---
echo "Restarting SSH service..."
# First, check for the modern socket-based activation (e.g., Ubuntu 22.10+)
if systemctl is-active --quiet ssh.socket; then
echo "SSH socket activation is active. Restarting ssh.socket..."
systemctl restart ssh.socket
else
# Fallback for traditional service-based systems (e.g., AlmaLinux, older Ubuntu/Debian)
# The service is usually called sshd.service, and ssh.service is often an alias.
echo "Standard SSH service detected. Restarting sshd.service..."
systemctl restart sshd.service
fi
echo ""
echo "----------------------------------------------------------------"
echo "SUCCESS!"
echo "The SSH port has been changed to: $SSHPORT"
echo ""
echo "IMPORTANT: Open a NEW terminal and test logging in with the new port BEFORE closing this session."
echo "Example: ssh your_user@your_server_ip -p $SSHPORT"
echo "----------------------------------------------------------------"
echo ""
exit 0
Comments are disabled for this gist.
Footer
© 2025 GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
Docs
Contact
Manage cookies
Do not share my personal information
You can’t perform that action at this time.