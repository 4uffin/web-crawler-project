Allow or block GeoIP in Nginx on Ubuntu 20.04 · GitHub
Skip to content
Search Gists
Search Gists
All gists
Back to GitHub
Sign in
Sign up
Sign in
Sign up
You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.
Dismiss alert
Instantly share code, notes, and snippets.
dunderrrrrr/GeoIP Block NGINX Ubuntu 20.04.md
Created
April 19, 2021 08:28
Show Gist options
Download ZIP
Star
21
(21)
You must be signed in to star a gist
Fork
18
(18)
You must be signed in to fork a gist
Embed
Embed
Embed this gist in your website.
Share
Copy sharable link for this gist.
Clone via HTTPS
Clone using the web URL.
Learn more about clone URLs
Clone this repository at &lt;script src=&quot;https://gist.github.com/dunderrrrrr/8d3fced1f73de2d70ede38f39c88d215.js&quot;&gt;&lt;/script&gt;
Save dunderrrrrr/8d3fced1f73de2d70ede38f39c88d215 to your computer and use it in GitHub Desktop.
Code
Revisions
1
Stars
21
Forks
18
Embed
Embed
Embed this gist in your website.
Share
Copy sharable link for this gist.
Clone via HTTPS
Clone using the web URL.
Learn more about clone URLs
Clone this repository at &lt;script src=&quot;https://gist.github.com/dunderrrrrr/8d3fced1f73de2d70ede38f39c88d215.js&quot;&gt;&lt;/script&gt;
Save dunderrrrrr/8d3fced1f73de2d70ede38f39c88d215 to your computer and use it in GitHub Desktop.
Download ZIP
Allow or block GeoIP in Nginx on Ubuntu 20.04
Raw
GeoIP Block NGINX Ubuntu 20.04.md
GeoIP Block NGINX Ubuntu 20.04
Block or filter IPs based on location in Nginx (tested on 1.18.0) on Ubuntu 20.04.
Install Nginx modules
To make use of the geographical filtering, we must first install the Nginx GeoIP module as well as the GeoIP database containing the mappings between visitors’ IP addresses and their respective countries. To do so, let’s execute:
$ sudo apt install libnginx-mod-http-geoip geoip-database
Download the GeoIP database.
$ sudo mkdir /usr/share/GeoIP
$ cd /usr/share/GeoIP
$ sudo wget sudo wget https://centminmod.com/centminmodparts/geoip-legacy/GeoIP.dat.gz
$ sudo gunzip GeoIP.dat.gz
Add config to nginx /etc/nginx/conf.d/geoip.conf:
# GeoIP database path
#
geoip_country /usr/share/GeoIP/GeoIP.dat;
Edit nginx config /etc/nginx/nginx.conf. Add this below the http { line to only allow Russian IPs You can use ISO’s full, searchable list of all country codes to find your code.
map $geoip_country_code $allowed_country {
default no;
RU yes;
}
Finally, add this to your sites virtual config /etc/nginx/sites-available/siteconfig below server {:
if ($allowed_country = no) {
return 403;
}
And reload Nginx sudo systemctl restart nginx
Copy link
vitordhers
commented
Jun 1, 2021
That's great! thanks for this simple tutorial.
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
Clyckov34
commented
Oct 9, 2022
Good
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
3IMAD69
commented
Oct 25, 2022
•
edited
Loading
Uh oh!
There was an error while loading. Please reload this page.
Thnaks . but for some reasons , its doesnt work on chrome , but work fine on other browser , i think it has something to do with caching
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
Author
dunderrrrrr
commented
Oct 25, 2022
Thnaks . but for some reasons , its doesnt work on chrome , but work fine on other browser , i think it has something to do with caching
It sure is possible. This gist is 2 years old, feel free to do some research and ill be glad to update the above.
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
3IMAD69
commented
Oct 25, 2022
•
edited
Loading
Uh oh!
There was an error while loading. Please reload this page.
Thnaks . but for some reasons , its doesnt work on chrome , but work fine on other browser , i think it has something to do with caching
It sure is possible. This gist is 2 years old, feel free to do some research and ill be glad to update the above.
nvm i fix it by putting the
if ($allowed_country = no) { return 403; }
FIRST on server {
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
Author
dunderrrrrr
commented
Oct 26, 2022
Thnaks . but for some reasons , its doesnt work on chrome , but work fine on other browser , i think it has something to do with caching
It sure is possible. This gist is 2 years old, feel free to do some research and ill be glad to update the above.
nvm i fix it by putting the if ($allowed_country = no) { return 403; } FIRST on server {
Ah, perfect :)
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
github-prashant15
commented
Aug 30, 2023
Heyy Dear,
Thank you very much. For the well-mentioned tutorial.
But I have a question: Does anyone use a VPN to reach my country?
They got access to my URL.
Please tell me how I may overcome that problem.
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
RokkuCode
commented
Oct 31, 2023
you can't. even netflix fails to do this. there is no technical proper way to detect vpn conns.
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Sign up for free
to join this conversation on GitHub.
Already have an account?
Sign in to comment
Footer
© 2025 GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
Community
Docs
Contact
Manage cookies
Do not share my personal information
You can’t perform that action at this time.