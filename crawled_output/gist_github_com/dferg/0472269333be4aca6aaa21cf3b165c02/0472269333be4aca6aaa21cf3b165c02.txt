howto-split-dns-macos.md · GitHub
Skip to content
Search Gists
Search Gists
All gists
Back to GitHub
Sign in
Sign up
Sign in
Sign up
You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.
Dismiss alert
Instantly share code, notes, and snippets.
dferg/howto-split-dns-macos.md
Last active
September 17, 2025 18:09
Show Gist options
Download ZIP
Star
61
(61)
You must be signed in to star a gist
Fork
9
(9)
You must be signed in to fork a gist
Embed
Embed
Embed this gist in your website.
Share
Copy sharable link for this gist.
Clone via HTTPS
Clone using the web URL.
Learn more about clone URLs
Clone this repository at &lt;script src=&quot;https://gist.github.com/dferg/0472269333be4aca6aaa21cf3b165c02.js&quot;&gt;&lt;/script&gt;
Save dferg/0472269333be4aca6aaa21cf3b165c02 to your computer and use it in GitHub Desktop.
Code
Revisions
6
Stars
61
Forks
9
Embed
Embed
Embed this gist in your website.
Share
Copy sharable link for this gist.
Clone via HTTPS
Clone using the web URL.
Learn more about clone URLs
Clone this repository at &lt;script src=&quot;https://gist.github.com/dferg/0472269333be4aca6aaa21cf3b165c02.js&quot;&gt;&lt;/script&gt;
Save dferg/0472269333be4aca6aaa21cf3b165c02 to your computer and use it in GitHub Desktop.
Download ZIP
Raw
howto-split-dns-macos.md
Introduction
Sometimes you may want to use a DNS server for specific domain requests and another DNS server for all other requests. This is helpful, for instance, when connected to a VPN. For hosts behind that VPN you want to use the VPN's DNS server but all other hosts you want to use Google's public DNS. This is called "DNS splitting."
Here, we run dnsmasq as a background service on macOS. The dnsmasq configuration described below implements DNS splitting.
Install
brew install dnsmasq
Don't have Homebrew? Follow the instructions here: https://brew.sh
Setup
Add the following lines to $(brew --prefix)/etc/dnsmasq.conf:
# Ignore /etc/resolv.conf
no-resolv
# For queries *.domain.com and *.domain.net, forward to the specified DNS server
# Servers are queried in order (if the previous fails)
# -- Note: These are EXAMPLES. Replace with your desired config.
server=/domain.com/domain.net/IP_ADDR_OF_SERVER1
server=/domain.com/domain.net/IP_ADDR_OF_SERVER2
# Forward all other requests to Google's public DNS server
server=8.8.8.8
# Only listen for DNS queries on localhost
listen-address=127.0.0.1
# Required due to macOS limitations
bind-interfaces
Start dnsmasq
Run the following command to start dnsmasq immediately and have it start on reboot.
sudo brew services start dnsmasq
Point macOS to the new server
Via GUI
To point to the new split DNS server, follow these steps:
Open up "System Preferences," click on "Network."
The first interface with a green ball is your default interface. Click on it and then "Advanced."
Click on the "DNS" tab.
Click on "+" and type in "127.0.0.1"
Click on "OK"
Click on "Apply"
Via Scripting
To point to the new DNS server via scripting, run the following command (replacing "Wi-Fi" with whatever your interface name is):
sudo networksetup -setdnsservers "Wi-Fi" 127.0.0.1
To clear the DNS server change:
sudo networksetup -setdnsservers "Wi-Fi" empty
Test
Check that hosts within each of your "server=" directives resolves as expected.
dig somehost.domain.com
Check that hosts that do not match any "server=" directive go out to the default DNS server.
dig www.google.com
Troubleshooting
Flush DNS caches
If DNS queries are not behaving as expected, flush macOS's DNS cache.
sudo dscacheutil -flushcache
sudo killall -HUP mDNSResponder
Copy link
adrianharabula
commented
Nov 1, 2019
Excelent snippet! I've been searching for something like this past 2 weeks. Thanks for sharing.
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
xsreality
commented
Mar 10, 2020
Thanks, this worked nicely! Is there a way to configure the dynamic default DNS IP (provided by the default gateway) instead of static IP like 8.8.8.8?
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
ClaytonOlleyITN
commented
Jun 3, 2020
My mac keeps reverting to the DHCP provided DNS servers even though I've set it to 127.0.0.1 in the VPN config. Anyone know of a fix?
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
DGavrilets
commented
Nov 29, 2022
What should I do with this problem:
Error: Running Homebrew as root is extremely dangerous and no longer supported.
As Homebrew does not drop privileges on installation you would be giving all build scripts full access to your system.
Error: Failure while executing;
'/opt /homebrew/bin/brew tap homebrew/services' exited with 1.
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Copy link
goors
commented
Jun 2, 2024
•
edited
Loading
Uh oh!
There was an error while loading. Please reload this page.
yeah does not work if you use ipsec. any solution?
Sorry, something went wrong.
Uh oh!
There was an error while loading. Please reload this page.
Sign up for free
to join this conversation on GitHub.
Already have an account?
Sign in to comment
Footer
© 2025 GitHub, Inc.
Footer navigation
Terms
Privacy
Security
Status
Docs
Contact
Manage cookies
Do not share my personal information
You can’t perform that action at this time.